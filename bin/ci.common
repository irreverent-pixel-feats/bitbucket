#!/bin/sh -eux

git submodule init
git submodule update

cabal update

cd bitbucket-cli
make build
cd ../

find . -type f -name "*.cabal" | grep -v "^\./lib" | while read P; do
  cd "$(dirname "${P}")"
  ./mafia build
  ./mafia test
  cd -
done
