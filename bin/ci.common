#!/bin/sh -eux

git submodule init
git submodule update

find . -find f -name "*.cabal" | grep -v "^\./lib" | while read P; do
  cd "$(dirname "${P}")"
  ./mafia build
  ./mafia test
  cd -
done
